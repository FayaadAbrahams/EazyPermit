<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eazy Permit</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"></script>
    <script type="module" src="./js/main.js"></script>
    <style>
      body{
        background-color: #d60076 !important;
      }
    section {
      border-radius: 12px;
      max-width: 800px;
      height: 500px;
      margin: 2rem auto;
    }

    #chatbot {
      background-color: rgb(109, 109, 122);
      width: 100%;
      max-height: 1000px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 18px; /* Increased font size */
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #chatbox {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      height: 300px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: flex-start;
      align-items: flex-start;
      font-size: 18px; /* Increased font size for messages */
    }

    .message {
  padding: 10px 15px;
  border-radius: 20px;
  max-width: 80%;
  line-height: 1.4;
  word-wrap: break-word;
  font-size: 18px;
  margin-bottom: 15px;   
}

    .message.bot {
      background-color: #e9ecef;
      color: #333;
      align-self: flex-start;
      margin: 0 0 1em 0; /* adds space below each paragraph */
  line-height: 1.5;
    }

  

    .message.user {
      background-color: #007bff;
      color: white;
      align-self: flex-end;
    }

    #userInput {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      outline: none;
      font-size: 18px; /* Increased input font size */
      width: 100%;
      box-sizing: border-box;
      margin-top: 10px;
    }
  </style>
  </head>

  <body>
    <header class="header">
      <div class="header-1">
        <div class="flex">
          <img src="../assets/img/profile.svg" alt>
          <p>
            <!-- <a href="login.html">login /</a>
              <a href="register.html">register</a> -->
            <a href>John Dory</a>
          </p>
        </div>
      </div>

      <div class="header-2">
        <a href="landing-page.html" class="logo">
          <img
            width="230px"
            height="201px"
            src="../assets/img/cct-logo.svg"
            type="images/jpg"
            alt="CCT Logo" />
        </a>

        <nav class="navbar">
          <a href="../pages/dashboard.html">Dashboard</a>
          <a href="../pages/ZoningPage.html">Zoning Info</a>
          <a href="../pages/contact page.html">Contact us</a>
          <a href="../pages/Checkout.html">Pay Bills</a>
        </nav>
      </div>
    </header>
    <br><br>
    <div class="dashboard-header">
      <h1>Identify and Understand Your Zoning Property</h1>

    </div>

    <section>
      <div id="chatbot">
        <div id="chatbox"></div>
        <input
          id="userInput"
          placeholder="Type your message here..."
          autocomplete="off"
          autofocus />
      </div>
    </section>

    <script>
    const zoningTypes = {
      "Single Residential": {
        short:
          "Low-to-medium density homes with limited home employment allowed.",
        details: `
üè° Single Residential<br>
- Primarily single-family homes in low-to-medium density areas.<br>
- Allows limited home employment, additional dwellings, and low-intensity mixed-use.<br>
- Provides a safe, pleasant residential environment.<br>
        `,
      },
      "General Residential": {
        short: "Higher-density urban living with limited mixed-use.",
        details: `
üè¢ General Residential<br>
- Supports medium to high-density living (e.g., flats, townhouses).<br>
- Encourages urban growth and avoids sprawl.<br>
- Allows some mixed-use and home-based businesses with restrictions.<br>
- Development intensity varies by sub-zoning.<br>
        `,
      },
      Community: {
        short: "Zoning for educational, religious, welfare, and health services.",
        details: `
üè• Community (CO1 & CO2)<br>
- For schools, churches, clinics, and community centers.<br>
- CO1 serves local community needs.<br>
- CO2 serves wider regional needs and may allow larger buildings.<br>
- Encourages attractive, focal buildings.<br>
        `,
      },
      "Local Business": {
        short: "Shops and offices in neighbourhood areas with controlled retail.",
        details: `
üè™ Local Business<br>
- For neighbourhood shops, offices, and low-impact retail.<br>
- Provides buffer between busy business districts and homes.<br>
- Larger or high-impact retail is restricted or needs consent.<br>
        `,
      },
      "General Business and Mixed-use": {
        short:
          "Broad economic development with residential, business and some industrial.",
        details: `
üè¨ General Business & Mixed-use<br>
- Mixes residential, business, and some light industrial uses.<br>
- Common in development corridors and town centers.<br>
- Requires careful planning to minimize residential-industrial conflicts.<br>
        `,
      },
      Industrial: {
        short: "For manufacturing, including general and hazardous industry.",
        details: `
üè≠ Industrial<br>
- For factories, warehouses, and heavy-duty production.<br>
- Includes general and hazardous industries.<br>
- Requires good infrastructure (roads, waste).<br>
- Should be separate from residential areas.<br>
        `,
      },
      "Utility, Transport, National Port": {
        short: "Used for public transport, utilities, and national port activities.",
        details: `
üöâ Utility, Transport & National Port<br>
- For public services like power stations, roads, railways, and harbours.<br>
- Zoning based on function, not ownership.<br>
- May allow mixed-use if it doesn‚Äôt interfere with operations.<br>
- Port zones governed by the National Ports Act.<br>
        `,
      },
      "Open Space": {
        short: "Includes parks, nature reserves, and recreation areas.",
        details: `
üå≥ Open Space<br>
- Parks, sports fields, nature reserves, and recreational areas.<br>
- Important for community wellbeing and biodiversity protection.<br>
        `,
      },
      "Agricultural, Rural and Limited Use": {
        short: "For farming and rural preservation; limits urban encroachment.",
        details: `
üåæ Agricultural, Rural & Limited Use<br>
- Protects farming land and rural lifestyle.<br>
- AG = large farms, RU = smallholdings, LU = undetermined land.<br>
- Permits activities supporting agriculture.<br>
        `,
      },
    };

    const chatbox = document.getElementById("chatbox");
    const input = document.getElementById("userInput");
    let step = 0;
    let userZoning = null;
    let businessType = null;

    function getZoningList() {
      return Object.keys(zoningTypes)
        .map(
          (key, i) =>
            `${i + 1}. <strong>${key}</strong> ‚Äî ${zoningTypes[key].short}`
        )
        .join("<br>");
    }

    function parseZoningInput(input) {
      const names = Object.keys(zoningTypes);
      const num = parseInt(input);
      if (!isNaN(num) && num >= 1 && num <= names.length) {
        return names[num - 1];
      }
      return names.find((name) => name.toLowerCase() === input.toLowerCase()) || null;
    }

    function checkForMusicQuery(text) {
      const keywords = [
        "music",
        "noise",
        "sound",
        "amplified",
        "loud",
        "mobile food truck",
        "hawker",
        "playing music",
      ];
      return keywords.some((k) => text.includes(k));
    }

    function addMessage(text, sender = "bot") {
      const div = document.createElement("div");
      div.classList.add("message", sender);
      div.innerHTML = text;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function startChat() {
      addMessage("Hi! üëã Do you know your property's zoning? (Type 'yes' or 'no')");
      step = 1;
    }

    function handleStep(inputText) {
      const text = inputText.trim().toLowerCase();

      if (step === 1) {
        if (text === "yes") {
          addMessage(
            "Great! You can type the zoning type or number."
          );
          step = 2;
        } else if (text === "no") {
          addMessage(
            "You can view the official zoning map here: <a href='https://citymaps.capetown.gov.za/EGISViewer/' target='_blank'>Zoning Map</a>"
          );
          addMessage("Once you know it, type it here or type 'list' to see all zoning types.");
          step = 2;
        } else {
          addMessage("Please reply with 'yes' or 'no' üòä");
        }
      } else if (step === 2) {
        if (text === "list") {
          addMessage("Here are the zoning types:<br>" + getZoningList());
        } else {
          const zoningName = parseZoningInput(text);
          if (zoningName) {
            userZoning = zoningName;
            addMessage(zoningTypes[zoningName].details);
            addMessage(
              "What type of business are you planning to operate? (e.g. food truck, spa, retail shop, nightclub)"
            );
            step = 3;
          } else {
            addMessage("Sorry, I didn‚Äôt understand. Try typing 'list' or a zoning name.");
          }
        }
      } else if (step === 3) {
        businessType = text;

        if (checkForMusicQuery(text) || text.includes("mobile") || text.includes("music")) {
          let message = `üéµ <strong>Impact of Music on Zoning</strong><br><br>`;

if (userZoning === "Community") {
  message += `<p>üîá In a <strong>Community Zone</strong>:<br>
- Loud or amplified music is generally <em>not permitted</em>.<br>
- You may need to apply for special consent or a noise exemption.</p>`;
} else {
  message += `<p>üìå Zoning impact depends on the area and noise bylaws. Music may be allowed with permits in some zones.</p>`;
}

if (text.includes("food truck")) {
  message += `<p>üöö <strong>Mobile Coffee Truck</strong>:<br>
- Must comply with the City's <a href="https://www.capetown.gov.za/City-Connect/Apply/Planning-building-and-development/Land-use-applications/Noise-control" target="_blank">Noise Control Bylaw</a>.<br>
- Playing loud music is often restricted in residential or community zones.<br>
- You may need a permit for any sound equipment or events.</p>`;
}

          addMessage(message);
        } else {
          addMessage(
            "‚úÖ Thank you! Based on your zoning and business type, you can contact the City for further compliance steps or licensing info."
          );
        }
      }
    }

    startChat();

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && input.value.trim() !== "") {
        const userText = input.value.trim();
        addMessage(userText, "user");
        input.value = "";
        setTimeout(() => handleStep(userText), 300);
      }
    });
  </script>
    <footer>
      <span>
        Copyright 2025 City of Cape Town. All rights reserved.
      </span>
    </footer>
  </body>
</html>
